<!--index.wxml-->
<scroll-view class="scrollview" scroll-y type="list">
  <view class="container">
    <!-- å·²ç»ç™»å½• -->
    <view wx:if="{{ isloggedin }}">
      <view wx:if="{{ loading }}">
        <van-skeleton title avatar row="3" />
        <van-skeleton title avatar row="3" />
        <van-skeleton title avatar row="3" />
      </view>
      <view wx:elif="{{ !repairFlag }}">
        <view wx:for="{{ ticketList }}" wx:key="id">
            <view
              wx:if="{{ item.repair_status !== 'Done' && item.repair_status !== 'Canceled' && item.repair_status !== 'Closed' }}">
              <navigator url="/pages/homePage/ticketDetail/index?id={{ item.id }}&role={{ userInfo.role }}"
                open-type="navigate">
                <van-card class="class-status-{{ item.repair_status }}" desc="{{ item.repair_description }}"
                  title="{{ item.device_type }} {{ item.fault_type }}" thumb="{{ item.repair_image_url }}"
                  tag="{{ statusList[item.repair_status] }}">
                  <view slot="bottom">åˆ›å»ºæ—¶é—´ï¼š{{ item.create_time }}</view>
                  <view slot="tags">
                    <van-tag plain type="primary">{{ item.campus }}</van-tag>
                    <van-tag plain type="warning">{{ item.computer_brand }}</van-tag>
                  </view>
                </van-card>
              </navigator>
              <van-divider />
            </view>
          </view>
        <van-empty description="{{ restMsg }}" />
      </view>
      <view wx:elif='{{ userInfo.role === "user" }}'>
        <view wx:if="{{ !hasUnfinishedStatus }}">
          <van-empty description="æ‚¨è¿˜æ²¡æœ‰ç»´ä¿®ä¸­çš„å·¥å•å“¦" />
        </view>
        <view wx:else>
          <view wx:for="{{ ticketList }}" wx:key="id">
            <view
              wx:if="{{ item.repair_status !== 'Done' && item.repair_status !== 'Canceled' && item.repair_status !== 'Closed' }}">
              <navigator url="/pages/homePage/ticketDetail/index?id={{ item.id }}&role={{ userInfo.role }}"
                open-type="navigate">
                <van-card class="class-status-{{ item.repair_status }}" desc="{{ item.repair_description }}"
                  title="{{ item.device_type }} {{ item.fault_type }}" thumb="{{ item.repair_image_url }}"
                  tag="{{ statusList[item.repair_status] }}">
                  <view slot="bottom">åˆ›å»ºæ—¶é—´ï¼š{{ item.create_time }}</view>
                  <view slot="tags">
                    <van-tag plain type="primary">{{ item.campus }}</van-tag>
                    <van-tag plain type="warning">{{ item.computer_brand }}</van-tag>
                  </view>
                </van-card>
              </navigator>
              <van-divider />
            </view>
          </view>
        </view>
        <view class="btn-container">
          <van-button round icon="build" class-prefix="material-icons" type="info" bind:click="onShowDialog">
            æˆ‘è¦æŠ¥ä¿®
          </van-button>
        </view>
      </view>
      <view wx:elif='{{ userInfo.role === "technician" }}'>
        <view wx:if="{{ !hasUnfinishedStatus }}">
          <van-tabs type="line" active="{{ activeTab }}" bind:change="onTabChange">
            <van-tab wx:for="{{ ['æ€»æ¦œ', 'æ±Ÿå®‰æ¦œ', 'ç£¨å­æ¡¥æ¦œ'] }}" wx:key="id" title="{{ item }}" name="{{ item }}">
              <view wx:if="{{ topTech.length === 3 }}" class="ranking-container">
                <view class="ranking-box second">
                  <view class="badge">ç¬¬2å</view>
                  <view class="circle">
                    <view class="number">{{ topTech[1].count }}</view>
                    <view class="unit">å°</view>
                  </view>
                  <view class="tech-name">ğŸ¥ˆ{{ topTech[1].nickname }}</view>
                  <view class="div-line"></view>
                </view>
                <view class="ranking-box first">
                  <view class="badge">ç¬¬1å</view>
                  <view class="circle">
                    <view class="number">{{ topTech[0].count }}</view>
                    <view class="unit">å°</view>
                  </view>
                  <view class="tech-name">ğŸ¥‡{{ topTech[0].nickname }}</view>
                  <view class="div-line"></view>
                </view>
                <view class="ranking-box third">
                  <view class="badge">ç¬¬3å</view>
                  <view class="circle">
                    <view class="number">{{ topTech[2].count }}</view>
                    <view class="unit">å°</view>
                  </view>
                  <view class="tech-name">ğŸ¥‰{{ topTech[2].nickname }}</view>
                  <view class="div-line"></view>
                </view>
              </view>
            </van-tab>
          </van-tabs>
          <van-empty description="æ‚¨è¿˜æ²¡æœ‰æ¥åˆ°çš„å·¥å•å“¦" />
        </view>
        <view wx:else>
          <view wx:for="{{ ticketList }}" wx:key="id">
            <view
              wx:if="{{ item.repair_status !== 'Done' && item.repair_status !== 'Canceled' && item.repair_status !== 'Closed' }}">
              <navigator url="/pages/homePage/ticketDetail/index?id={{ item.id }}&role={{ userInfo.role }}"
                open-type="navigate">
                <van-card class="class-status-{{ item.repair_status }}" desc="{{ item.repair_description }}"
                  title="{{ item.device_type }} {{ item.fault_type }}" thumb="{{ item.repair_image_url }}"
                  tag="{{ statusList[item.repair_status] }}">
                  <view slot="bottom">åˆ›å»ºæ—¶é—´ï¼š{{ item.create_time }}</view>
                  <view slot="tags">
                    <van-tag plain type="primary">{{ item.campus }}</van-tag>
                    <van-tag plain type="warning">{{ item.computer_brand }}</van-tag>
                  </view>
                </van-card>
              </navigator>
              <van-divider />
            </view>
          </view>
        </view>
        <view class="btn-container">
          <van-button round class="give-order-btn" icon="center_focus_weak" class-prefix="material-icons" type="info"
            bind:click="onScanCode">
            æ‰«ç æ¥å•
          </van-button>
          <van-button round class="give-order-btn" icon="drag_indicator" class-prefix="material-icons" type="primary"
            bind:click="navigateToGiveOrderPage">
            æ‰‹åŠ¨æ¥å•
          </van-button>
        </view>
      </view>
      <view wx:elif='{{ userInfo.role === "admin" }}'>
        <van-cell-group wx:if="{{ sysConfig !== null }}" inset title="å…¨å±€è®¾ç½®">
          <view wx:for="{{ sysConfig }}" wx:key="name">
            <van-field required center autosize name="{{ item.name }}" data-name="{{ item.name }}"
              type="{{ item.name === 'Global_Tips' ? 'textarea' : 'digit' }}" label="{{ item.info }}"
              placeholder="è¯·è¾“å…¥{{ item.info }}" value="{{ item.data }}" border="{{ false }}"
              bind:change="onSysConfigChange">
              <view class="material-icons" slot="right-icon"> settings </view>
            </van-field>
          </view>
          <view class="btn-container">
            <van-button round icon="save" class-prefix="material-icons" type="info" bind:click="onSaveSysConfig">
              ä¿å­˜
            </van-button>
          </view>
        </van-cell-group>
      </view>
    </view>
    <!-- å°šæœªç™»å½• -->
    <view wx:else>
      <van-empty description="è¯·å…ˆç™»å½•ï½" />
    </view>
  </view>
  <van-dialog use-slot title="ç»´ä¿®æ¡æ¬¾åŠéšç§åè®®" show="{{ showDialog }}" show-cancel-button bind:close="onCloseDialog"
    show-confirm-button="{{ announcementAgreed }}" confirm-button-text="ç»§ç»­" bind:confirm="navigateToSubmitTicketPage">
    <view class="dialog-article-container">
      <towxml nodes="{{ article }}" />
      <van-checkbox value="{{ announcementAgreed }}" bind:change="onAgreeChange">
        æˆ‘å·²é˜…è¯»å¹¶åŒæ„ç»´ä¿®æ¡æ¬¾åŠéšç§åè®®
      </van-checkbox>
    </view>
  </van-dialog>
  <van-dialog id="van-dialog" />
  <van-toast id="van-toast" />
</scroll-view>
